# chronsite

## 0. Presentation

This repo was written as part of the eleven x X-HEC Data Science for Business hackathon. The mission we were working on was chronsite, a real-time analysis of the productivity of a team on a building site by computer vision.

## 1. Install project

To use this project, a virtual environment is required. Please run the following command lines:

```bash
$ make virtual
$ . venv/bin/activate
$ make install
```

## 2. Run project

First of all, please upload `poly.tar` at the root of the project. Then, you can run the project through a make command:

```bash
$ make run
```

This function downloads the data and launches the pipelines successively.

### Pipelines:

Here are the pipeline's successive tasks:

- **BlobStorageConnexion** <br>
  Uses credentials stored in `blob_credentials.py` to retrieve and download image datasets stored in an Azure cloud storage space.

- **JsonPreprocessingAnalyticsPipeline** <br>
  Extracts all relevant information from all the labelling JSON files, in particular the size, shapes and positions of both the rectangles (boxes) and polygons (zones) corresponding to workers, formworks, rebars and concrete pump hoses. <br>
  This data is stored in the `intermediate_process` folder as two separate pickle files: `boxes_processed` and `zones_processed`

- **ConcretePumpPipeline** <br>
  Computes coordinates of the centroid and extremity of each concrete pump hoses in `zones_processed` processed in `JsonPreprocessingAnalyticsPipeline`. Extremity of the pump is computed as the pump's lowest coordinate point in the image. <br>
  The new information is stored in the `intermediate_process` folder as a pickle file: `pump_key_points` .

- **WorkingWorkersPipeline** <br>
  Computes for each image the workers that can be associated to a pump hose based on the pumps extremities computed in `ConcretePumpPipeline` and the workers `boxes_processed` processed in `JsonPreprocessingAnalyticsPipeline`. <br>
  Workers are classified as 'active' (i.e. associated to a pump) if they are within a working distance of either the pump's extremity or another active worker. The 'working distance' is calculated relative to the human-size detected in the picture, using the `get_typical_size` function defined in `utils.py`.

- **PlotWorkerPipeline** <br>
  Generates two CSV files giving the number of total workers and active workers at any given time, based on the information given of `WorkingWorkersPipeline`.
  These CSV files can then be used for visual analysis.

- **PlotHeatmapPipeline** <br>
  Generates a PNG heatmap of where the pump extremities have been identified throughout time, based on the `pump_key_points` information generated by `ConcretePumpPipeline`.

- **GetResultsTestSetPipeline** <br>
  Generates a JSON file with the predicted bounding boxes for the Testing Set. This JSON file satisfies the COCO annotation format. 